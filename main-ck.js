function Player(){this.x=50;this.y=400;this.height=50;this.width=40;this.yVelocity=0;this.xVelocity=0;this.currentAnimation=0;this.inAnimation=0;this.onTheGround=!1}function draw(){luigi.Animate(frame);luigi.CheckKeys();luigi.Update();frame+=1}function openConnection(){if(!conn.readyState||conn.readyState>1){$("#server").append("connecting<br>");conn=new WebSocket(serverUri);conn.onopen=function(){$("#server").append("websocket is open<br>");conn.send("woop")};conn.onmessage=function(e){zombocom.append(e.data||"")};conn.onclose=function(e){zombocom.append("Socket Closed");state.addClass("closed")};conn.onerror=function(e){console.log("WebSocket Error "+e)}}}function go(){if(!window.WebSocket)$("#server").append("Du er for d√•rligt at bruka websocket");else{$("#server").append("websocket is a go<br>");openConnection()}}function init(){document.addEventListener("keydown",function(e){keyPressed[e.keyCode]=!0},!1);document.addEventListener("keyup",function(e){keyPressed[e.keyCode]=!1},!1);var e=$("body").height();$("#bg").css({"padding-top":e/2-360+"px"});return setInterval(draw,16)}var animations=[];animations[0]=[28,0,16,24];animations[1]=[0,30,16,24];animations[2]=[199,0,16,24];animations[3]=[235,0,16,24];animations[4]=[169,0,16,24,199,0,16,24];animations[5]=[235,0,16,24,264,0,16,24];animations[6]=[84,0,16,24,112,0,16,24];animations[7]=[321,0,16,24,348,0,16,24];animations[8]=[85,30,16,24];animations[9]=[348,30,16,24];animations[10]=[112,30,16,24];animations[11]=[321,30,16,24];animations[12]=[54,30,16,24];animations[13]=[378,30,16,24];var sJump=new Audio("audio/jump.wav"),frame=0,keyPressed={},GRAVITY=9.81,conn;Player.prototype.Jump=function(){if(this.onTheGround){sJump.play();this.yVelocity=-20;this.onTheGround=!1}};Player.prototype.CheckKeys=function(){if(keyPressed[37]&&keyPressed[39])this.currentAnimation=1;else if(keyPressed[37]){if(keyPressed[90]){this.currentAnimation=6;this.RunLeft(6)}else{this.currentAnimation=4;this.RunLeft(2)}keyPressed[88]&&this.Jump()}else if(keyPressed[39]){if(keyPressed[90]){this.currentAnimation=7;this.RunRight(6)}else{this.currentAnimation=5;this.RunRight(2)}keyPressed[88]&&this.Jump()}else if(keyPressed[88])this.Jump();else if(keyPressed[38])this.currentAnimation===2||this.currentAnimation===8?this.currentAnimation=8:this.currentAnimation=9;else if(keyPressed[40])this.currentAnimation===2||this.currentAnimation===10?this.currentAnimation=10:this.currentAnimation=11;else if(this.currentAnimation!==6&&this.currentAnimation!==12||this.xVelocity===0)if(this.currentAnimation!==7&&this.currentAnimation!==13||this.xVelocity===0){if(this.currentAnimation===4||this.currentAnimation===8||this.currentAnimation===10||this.currentAnimation===12)this.currentAnimation=2;else if(this.currentAnimation===5||this.currentAnimation===9||this.currentAnimation===11||this.currentAnimation===13)this.currentAnimation=3}else this.currentAnimation=13;else{this.currentAnimation=12;console.log("wooo")}};Player.prototype.Animate=function(e){this.inAnimation>=animations[this.currentAnimation].length&&(this.inAnimation=0);$("#luigi").css("background-position","-"+animations[this.currentAnimation][this.inAnimation]*2+"px -"+animations[this.currentAnimation][this.inAnimation+1]*2+"px");e%10===0&&(this.inAnimation+=4)};Player.prototype.Update=function(){this.Gravity();this.Collision();this.Friction();$("#luigi").css("top",this.y);$("#luigi").css("left",this.x)};Player.prototype.Gravity=function(){this.yVelocity+=GRAVITY*.1;this.y+=this.yVelocity*1};Player.prototype.RunRight=function(e){this.xVelocity<e&&(this.xVelocity+=4)};Player.prototype.RunLeft=function(e){this.xVelocity>-e&&(this.xVelocity-=4)};Player.prototype.Friction=function(){if(this.xVelocity<0){this.xVelocity+=.5;this.xVelocity>-1&&(this.xVelocity=0);this.x+=this.xVelocity}else if(this.xVelocity>0){this.xVelocity-=.5;this.xVelocity<1&&(this.xVelocity=0);this.x+=this.xVelocity}else this.xVelocity=0};Player.prototype.Collision=function(){var e=this;e.onTheGround=!1;$(".collidable").each(function(t){var n=parseInt($(this).css("top"),10),r=parseInt($(this).css("top"),10)+parseInt($(this).height(),10),i=parseInt($(this).css("left"),10),s=parseInt($(this).css("left"),10)+parseInt($(this).width(),10);if(e.y+e.height>n&&e.x+e.width>=i&&e.x<=s){if(e.y+e.height<n+50&&e.yVelocity>=0){e.yVelocity=0;e.y=n-e.height;e.onTheGround=!0}else if(e.y>r-50&&e.yVelocity<0){e.yVelocity=0;e.y=r+10}}else e.xVelocity<0&&e.x-10<s&&e.x+e.width>i&&e.y+e.height>n&&e.y<r?e.x=s+10:e.xVelocity>0&&e.x+5<s&&e.x+e.width>i-5&&e.y+e.height>n&&e.y<r&&(e.x=i-e.width-5)});if(e.y>720){e.y=100;e.x=200;e.yVelocity=0}};var luigi=new Player,conn={},serverUri="ws://127.0.0.1:1337",zombocom=$("#server"),state=$("#state");